<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Terminal 3D Airspace Sculptor</title>
  <style>
    html, body, #cesiumContainer {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: monospace;
      background: #000;
    }
    #statusLog {
      position: absolute;
      top: 10px;
      left: 10px;
      max-width: 400px;
      font-size: 12px;
      background: rgba(0, 0, 0, 0.6);
      color: #fff;
      border: 1px solid #444;
      border-radius: 4px;
      padding: 10px;
      z-index: 999;
    }
  </style>
</head>
<body>
  <div id="cesiumContainer"></div>
  <div id="statusLog">🚀 Initializing viewer...</div>

  <script src="https://cesium.com/downloads/cesiumjs/releases/1.113/Build/Cesium/Cesium.js"></script>
  <script>
    const log = (msg, isError = false) => {
      console.log(msg);
      const status = document.getElementById("statusLog");
      if (status) {
        status.innerHTML += "<br>" + (isError ? "❌ " : "✅ ") + msg;
      }
    };

    (async function initViewer() {
      try {
        log("Cesium module loaded.");
        Cesium.Ion.defaultAccessToken = "YOUR_ACCESS_TOKEN_HERE";

        const terrainProvider = await Cesium.createWorldTerrainAsync();
        log("World terrain loaded.");

        const viewer = new Cesium.Viewer("cesiumContainer", {
          terrainProvider,
          sceneMode: Cesium.SceneMode.SCENE3D,
          shouldAnimate: true
        });

        log("Viewer instantiated.");
        viewer.scene.globe.enableLighting = true;

        viewer.camera.flyTo({
          destination: Cesium.Cartesian3.fromDegrees(-118.4085, 33.9416, 3000),
          orientation: {
            heading: Cesium.Math.toRadians(0),
            pitch: Cesium.Math.toRadians(-30),
            roll: 0.0
          }
        });

        log("Camera flying to LAX coordinates.");

        const glbUrl = "airspace.glb";
        let retries = 2;

        const loadModel = async (url, fallback = false) => {
          const label = fallback ? "Fallback" : "Primary";
          log(`${label} model loading: ${url}`);

          const model = await Cesium.Model.fromGltfAsync({
            url,
            modelMatrix: Cesium.Transforms.eastNorthUpToFixedFrame(
              Cesium.Cartesian3.fromDegrees(-118.4085, 33.9416, 1000)
            ),
            scale: 1.0,
          });

          viewer.scene.primitives.add(model);
          log(`${label} model successfully loaded.`);
        };

        for (let attempt = 1; attempt <= retries + 1; attempt++) {
          try {
            await loadModel(glbUrl);
            break;
          } catch (err) {
            log(`Attempt ${attempt} failed: ${err.message}`, true);
            if (attempt > retries) {
              log("Loading fallback model...");
              await loadModel("https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/CesiumMan/glTF-Binary/CesiumMan.glb", true);
            } else {
              log("Retrying...");
            }
          }
        }
      } catch (err) {
        log("Critical failure: " + err.message, true);
        document.body.style.backgroundColor = "#300";
      }
    })();
  </script>
</body>
</html>

